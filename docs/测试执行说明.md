# UPnPCast库测试执行说明

本文档提供了UPnPCast库第七阶段测试的执行方法，包括准备工作、测试步骤和结果收集。

## 一、测试准备工作

### 1. 测试设备准备

- **测试手机设备**：
  - 低端设备：Android 7.0，2GB RAM
  - 中端设备：Android 10.0，4GB RAM 
  - 高端设备：Android 13.0，8GB+ RAM

- **测试DLNA设备**：
  - 准备至少3种不同厂商的DLNA设备（电视、音箱等）
  - 确保所有设备都连接到同一WiFi网络

- **测试环境**：
  - 确保WiFi信号良好
  - 准备视频样本文件（MP4、MKV等，不同分辨率）
  - 如需测试弱网，准备网络限流工具（例如clumsy）

### 2. 测试工具安装

1. **编译并安装Demo应用**：
   ```
   ./gradlew :app-demo:installDebug
   ```

2. **安装性能监控工具**：
   - Android Studio Profiler
   - 或使用Android Device Monitor

3. **准备测试结果记录表**：
   - 使用我们提供的`测试记录模板.md`

## 二、测试执行步骤

### 第一天：功能测试

1. **启动测试助手**：
   - 打开Demo应用
   - 导航至"测试助手"界面

2. **自动功能测试**：
   - 点击"开始记录"按钮启动数据收集
   - 点击"开始自动测试"按钮执行基本功能测试
   - 测试结束后查看日志（位于test-logs目录）

3. **手动功能测试**：
   - 按照`测试用例-功能测试.md`文档中的步骤逐一执行
   - 每完成一项测试，在测试记录表中记录结果

### 第二天：异常场景测试

1. **网络中断恢复测试**：
   - 按照`测试用例-异常场景测试.md`文档的测试用例1.1-1.3执行
   - 使用飞行模式或WiFi开关模拟网络中断
   - 详细记录应用反应和恢复情况

2. **设备响应超时测试**：
   - 执行测试用例2.1-2.3
   - 使用网络代理工具（如Charles）模拟延迟和错误响应
   - 记录超时处理行为

3. **内存压力测试**：
   - 执行测试用例3.1-3.3
   - 使用Android开发者选项中的"不保留活动"选项
   - 同时运行多个内存密集型应用制造内存压力

4. **极端条件测试**：
   - 执行测试用例4.1-4.3
   - 使用网络工具模拟高延迟、高丢包率环境
   - 测试前后台切换和应用重启恢复能力

### 第三天：性能比较测试

1. **内存占用测试**：
   - 按照`测试用例-性能比较.md`的测试用例1.1-1.3执行
   - 使用Android Profiler记录内存曲线
   - 将优化前后的数据填入对比表格

2. **响应时间测试**：
   - 执行测试用例2.1-2.3
   - 使用Systrace或类似工具记录响应时间
   - 记录API调用链分析结果

3. **电池消耗测试**：
   - 执行测试用例3.1-3.3
   - 使用Battery Historian分析电池使用情况
   - 记录唤醒锁和网络活动情况

## 三、测试数据收集

### 1. 日志文件收集

- **测试日志**：位于`test-logs/`目录，包含：
  - 缓存统计日志（cache_stats_*.log）
  - 内存使用日志（memory_usage_*.csv）
  - 测试结果日志（test_results_*.log）

- **应用日志**：使用以下命令收集
  ```
  adb logcat -v threadtime > upnpcast_test_log.txt
  ```

### 2. 性能数据收集

- **内存曲线**：从Android Profiler导出
- **CPU使用率**：记录测试过程中的平均值和峰值
- **网络请求统计**：使用Charles记录并导出请求摘要

### 3. 缓存效率数据

- **命中率统计**：从缓存日志中提取
- **内存自适应行为**：记录不同内存环境下的缓存大小变化

## 四、测试报告生成

1. **汇总测试结果**：
   - 功能测试通过率：计算已通过测试/总测试数
   - 异常测试恢复率：计算成功恢复的异常场景/总异常场景
   - 性能改进百分比：计算每项指标的优化前后差异

2. **分析问题与建议**：
   - 整理测试中发现的所有问题
   - 按严重程度分类并提出改进建议

3. **生成最终报告**：
   - 使用Markdown格式整理为最终测试报告
   - 包含测试摘要、详细结果和未来改进方向

## 注意事项

1. 每项测试结束后，确保应用回到初始状态
2. 异常测试时密切监控应用是否崩溃或ANR
3. 低端设备测试中特别关注内存压力行为
4. 记录任何非预期行为，即使不属于当前测试关注点
5. 保存所有原始日志和性能数据，以便后续深入分析 