# UPnPCast库功能测试用例

## 测试环境
- 测试设备：最低版本 Android 5.0，主流版本 Android 9.0，最新版本 Android 13
- 测试网络：Wi-Fi局域网环境
- 测试DLNA设备：至少包含三种不同厂商的设备（如小米电视、三星电视、LG电视等）

## 1. 设备发现功能测试

### 测试用例 1.1：基本设备发现
1. **前置条件**：手机与DLNA设备连接在同一Wi-Fi网络
2. **操作步骤**：
   - 启动应用
   - 调用DLNACastManager.startDiscovery()
   - 等待10秒
3. **预期结果**：
   - 正确发现并列出局域网内的所有DLNA设备
   - 每个设备显示正确的名称和设备信息
   - 日志中记录了设备发现过程

### 测试用例 1.2：重复搜索
1. **前置条件**：手机与DLNA设备连接在同一Wi-Fi网络
2. **操作步骤**：
   - 启动设备搜索
   - 停止搜索（调用stopDiscovery）
   - 再次启动搜索
3. **预期结果**：
   - 两次搜索结果一致
   - 没有重复设备
   - 没有内存泄漏

### 测试用例 1.3：设备缓存验证
1. **前置条件**：已经完成一次设备搜索
2. **操作步骤**：
   - 调用UPnPCacheManager.getCacheSummary()查看缓存统计
   - 再次启动设备搜索
   - 再次查看缓存统计
3. **预期结果**：
   - 缓存命中率提高
   - 设备信息正确更新

## 2. 设备连接和断开测试

### 测试用例 2.1：正常连接设备
1. **前置条件**：已发现DLNA设备
2. **操作步骤**：
   - 从设备列表中选择一个设备
   - 调用connectToDevice(device)
3. **预期结果**：
   - 连接成功
   - onConnected回调被触发
   - 日志记录连接成功信息

### 测试用例 2.2：手动断开连接
1. **前置条件**：已连接到DLNA设备
2. **操作步骤**：
   - 调用disconnect()方法
3. **预期结果**：
   - 连接正常断开
   - onDisconnected回调被触发
   - 没有错误日志

### 测试用例 2.3：异常断开处理
1. **前置条件**：已连接到DLNA设备
2. **操作步骤**：
   - 关闭DLNA设备电源或网络
   - 等待连接超时
3. **预期结果**：
   - 系统检测到连接断开
   - onError或onDisconnected回调被触发
   - 错误信息清晰明确

## 3. 媒体播放控制测试

### 测试用例 3.1：播放视频
1. **前置条件**：已连接到DLNA设备
2. **操作步骤**：
   - 准备一个HTTP视频URL
   - 调用playMedia(deviceId, mediaUrl, title)
3. **预期结果**：
   - 视频在DLNA设备上播放
   - 播放状态更新为"PLAYING"
   - 没有错误日志

### 测试用例 3.2：暂停和恢复播放
1. **前置条件**：正在播放媒体
2. **操作步骤**：
   - 调用pausePlayback(deviceId)
   - 等待2秒
   - 调用resumePlayback(deviceId)
3. **预期结果**：
   - 视频暂停然后继续播放
   - 播放状态正确更新(PLAYING -> PAUSED -> PLAYING)
   - 播放位置保持一致

### 测试用例 3.3：停止播放
1. **前置条件**：正在播放媒体
2. **操作步骤**：
   - 调用stopPlayback(deviceId)
3. **预期结果**：
   - 视频停止播放
   - 播放状态更新为"STOPPED"
   - 设备返回到初始界面

## 4. 音量和进度调整测试

### 测试用例 4.1：调节音量
1. **前置条件**：正在播放媒体
2. **操作步骤**：
   - 调用setVolume(deviceId, 30)降低音量
   - 调用setVolume(deviceId, 70)增加音量
3. **预期结果**：
   - 设备音量正确改变
   - 没有错误日志

### 测试用例 4.2：静音控制
1. **前置条件**：正在播放媒体
2. **操作步骤**：
   - 调用setMute(deviceId, true)
   - 等待3秒
   - 调用setMute(deviceId, false)
3. **预期结果**：
   - 设备正确进入静音状态然后恢复
   - 操作无错误

### 测试用例 4.3：跳转播放进度
1. **前置条件**：正在播放较长媒体（>2分钟）
2. **操作步骤**：
   - 记录当前播放位置
   - 调用seekTo(deviceId, 60000) // 跳转到1分钟处
   - 等待5秒
   - 调用seekTo(deviceId, 120000) // 跳转到2分钟处
3. **预期结果**：
   - 媒体播放位置正确跳转
   - 播放继续进行
   - 播放位置回调正确更新

## 测试执行方法

以上测试用例可以通过以下方式执行：

1. **手动测试**：按照测试步骤在实际设备上操作，观察结果
2. **自动化测试**：使用以下测试脚本在测试环境中自动执行

```kotlin
// 测试脚本位于：app/src/androidTest/java/com/yinnho/upnpcast/test/
// FunctionalTests.kt - 功能测试集
```

## 测试结果记录

测试每个用例后，记录以下信息：

1. 测试时间
2. 测试设备型号和系统版本
3. 测试结果（通过/失败）
4. 如果失败，记录详细失败信息和日志
5. 其他观察到的异常行为 